"use strict";(self.webpackChunkzano_docs=self.webpackChunkzano_docs||[]).push([[3651],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,o=e.originalType,s=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),d=c(n),m=l,h=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function h(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var o=n.length,i=new Array(o);i[0]=m;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r[d]="string"==typeof e?e:l,i[1]=r;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3799:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var a=n(7462),l=(n(7294),n(3905));const o={},i="Signing transactions offline (cold-signing process)",r={unversionedId:"build/exchange-guidelines/signing-transactions-offline",id:"build/exchange-guidelines/signing-transactions-offline",title:"Signing transactions offline (cold-signing process)",description:"Introduction",source:"@site/docs/build/exchange-guidelines/signing-transactions-offline.md",sourceDirName:"build/exchange-guidelines",slug:"/build/exchange-guidelines/signing-transactions-offline",permalink:"/docs/build/exchange-guidelines/signing-transactions-offline",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"buildSidebar",previous:{title:"Hi-Load Servers (WARP-mode)",permalink:"/docs/build/exchange-guidelines/production-node"},next:{title:"Starting the daemon and the wallet application as RPC server",permalink:"/docs/build/exchange-guidelines/starting-the-daemon-and-the-wallet-application-as-rpc-server"}},s={},c=[{value:"Introduction",id:"introduction",level:3},{value:"Setup",id:"setup",level:3},{value:"Example of a transaction cold-signing",id:"example-of-a-transaction-cold-signing",level:3},{value:"Important note on watch-only wallets",id:"important-note-on-watch-only-wallets",level:3}],p={toc:c},d="wrapper";function u(e){let{components:t,...o}=e;return(0,l.kt)(d,(0,a.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"signing-transactions-offline-cold-signing-process"},"Signing transactions offline (cold-signing process)"),(0,l.kt)("h3",{id:"introduction"},"Introduction"),(0,l.kt)("p",null,"In order to provide more security it's possible to sign transactions offline using a dedicated wallet application instance e.g. running in a secure environment."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"alt signing-transactions-offline-introduction",src:n(2633).Z,title:"signing-transactions-offline-introduction",width:"1150",height:"848"})),(0,l.kt)("p",null,"Zano as a CryptoNote coin uses two key pairs (4 keys) per wallet: view key (secret+public) and spend key (secret+public)"),(0,l.kt)("p",null,"So-called \"hot wallet\" (or watch-only wallet) uses only view secret key. This allows it to distinguish its transactions among others in the blockchain. To spend coins a wallet needs to spend secret key. It is required to sign a tx. Watch-only wallet doesn't have access to spend secret key and thus it can't spend coins."),(0,l.kt)("p",null,"If someone has your spend secret key, he can spend your coins. Master keys should be handled with care."),(0,l.kt)("h3",{id:"setup"},"Setup"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"In a ",(0,l.kt)("em",{parentName:"p"},"secure environment")," create a new master wallet:"),(0,l.kt)("p",{parentName:"li"},"i. Start simplewallet to generate the master wallet:\n",(0,l.kt)("inlineCode",{parentName:"p"},"simplewallet --generate-new-wallet=zano_wallet_master"),(0,l.kt)("br",null),"(zano_wallet_master is wallet's filename and can be changed freely)",(0,l.kt)("br",null),"\nii. Type in a password when prompted. An empty new wallet will be created.",(0,l.kt)("br",null),"\niii. Open the new wallet again: ",(0,l.kt)("inlineCode",{parentName:"p"},"simplewallet --offline-mode --wallet-file=zano_wallet_master"),(0,l.kt)("br",null),"\niv. In the wallet console, type the following command:",(0,l.kt)("br",null),(0,l.kt)("inlineCode",{parentName:"p"},"save_watch_only zano_wallet_watch_only WATCH_PASSWORD"),(0,l.kt)("br",null)," where WATCH_PASSWORD is the password for the watch-only wallet. You should see: ",(0,l.kt)("inlineCode",{parentName:"p"},"Watch-only wallet has been stored to zano_wallet_watch_only"),(0,l.kt)("br",null),"\nv. Type ",(0,l.kt)("inlineCode",{parentName:"p"},"exit")," to quit simplewallet.",(0,l.kt)("br",null))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Copy zano_wallet_watch_only file from the secure environment to your production environment where daemons and the hot wallet is supposed to be run."))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"CAUTION: zano_wallet_master file contains master wallet's private keys! You may want to ensure it never leaves the secure environment.")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"In the production environment start the daemon. Let it sync with the network if running for the first time and make sure it gets synchronized. Then, start the watch-only wallet:",(0,l.kt)("br",null)," ",(0,l.kt)("inlineCode",{parentName:"li"},"simplewallet --wallet-file=zano_wallet_watch_only --password=WATCH_PASSWORD --rpc-bind-ip=RPC_IP --rpc-bind-port=RPC_PORT --daemon-address=DEAMON_ADDR:DAEMON_PORT --log-file=LOG_FILE_NAME")," (see also the Introduction; for the first run you may add ",(0,l.kt)("inlineCode",{parentName:"li"},"--log-level=0"),"  to avoid too verbose messages, for subsequent runs you may want to use ",(0,l.kt)("inlineCode",{parentName:"li"},"--log-level=1")," or ",(0,l.kt)("inlineCode",{parentName:"li"},"--log-level=2"),")")),(0,l.kt)("p",null,"The setup is complete."),(0,l.kt)("h3",{id:"example-of-a-transaction-cold-signing"},"Example of a transaction cold-signing"),(0,l.kt)("p",null,"In order to sign a transaction, follow these steps:"),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"Create a transaction using RPC ",(0,l.kt)("a",{parentName:"li",href:"https://docs.zano.org/docs/build/rpc-api/wallet-rpc-api/transfer"},"transfer"),".")),(0,l.kt)("p",null,"Because of using watch-only wallet keys for this instance of wallet application (please note passing ",(0,l.kt)("strong",{parentName:"p"},"zano_wallet_watch_only")," in i.3) a transaction will not be signed and broadcasted. Instead, an unsigned transaction will be prepared and returned back to the caller via RPC."),(0,l.kt)("p",null,"RPC example (please, see also ",(0,l.kt)("a",{parentName:"p",href:"https://docs.zano.org/docs/build/rpc-api/wallet-rpc-api/transfer"},"transfer")," RPC description in ",(0,l.kt)("a",{parentName:"p",href:"https://docs.zano.org/docs/build/rpc-api/overview"},'"List of RPC calls"')," section above):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'$ curl http://127.0.0.1:12233/json_rpc -s -H \'content-type:application/json;\' --data-binary \'{"jsonrpc":"2.0","id":"0","method":"transfer", "params":{   "destinations":[{"amount":1000000000000, "address":"ZxCb5oL6RTEffiH9gj7w3SYUeQ5s53yUBFGoyGChaqpQdud2uNUaA936Q2ngcEouvmgA48WMZQyv41R2ASstyYHo2Kzeoh7GA"}], "fee":10000000000, "mixin":0   }}\'\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "id": "0",\n  "jsonrpc": "2.0",\n  "result": {\n    "tx_hash": "",\n    "tx_size": 0,\n    "tx_unsigned_hex": "00-LONG-HEX-00"\n  }\n}\n')),(0,l.kt)("p",null,"Unsigned transaction data retrieved in ",(0,l.kt)("inlineCode",{parentName:"p"},"tx_unsigned_hex")," field should be passed to the secure environment for cold-signing by the master wallet."),(0,l.kt)("ol",{start:5},(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Run then master wallet in RPC mode within a secure environment:",(0,l.kt)("br",null),(0,l.kt)("inlineCode",{parentName:"p"},"simplewallet --wallet-file=zano_wallet_master --offline-mode --rpc-bind-port=RPC_PORT --rpc-bind-ip=RPC_IP")," (note that the master wallet is running in offline mode and doesn't need access to the Internet or Zano daemon).")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Using RPC ",(0,l.kt)("a",{parentName:"p",href:"https://docs.zano.org/docs/build/rpc-api/wallet-rpc-api/sign_transfer"},"sing_transfer")," sing the transaction using the master wallet."))),(0,l.kt)("p",null,"RPC example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'$ curl http://127.0.0.1:12233/json_rpc -s -H \'content-type:application/json;\' --data-binary \'{"jsonrpc":"2.0","id":"0","method":"sign_transfer", "params":{  "tx_unsigned_hex" : "00-LONG-HEX-00" }\'\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "id": "0",\n  "jsonrpc": "2.0",\n  "result": {\n    "tx_hash": "864dc39fe1f1440651a9c2cc0585ba2f91498778bae86583d37fcc0b251aea4a",\n    "tx_signed_hex": "00-LONG-HEX-00"\n  }\n}\n')),(0,l.kt)("p",null,"A signed transaction retrieved in ",(0,l.kt)("inlineCode",{parentName:"p"},"tx_signed_hex")," field should be passed back to the production environment to be broadcasted by the watch-only hot wallet."),(0,l.kt)("ol",{start:7},(0,l.kt)("li",{parentName:"ol"},"Using RPC ",(0,l.kt)("a",{parentName:"li",href:"https://docs.zano.org/docs/build/rpc-api/wallet-rpc-api/submit_transfer"},"submit_transfer")," broadcast the transaction via watch-only wallet.")),(0,l.kt)("p",null,"RPC example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'$ curl http://127.0.0.1:12233/json_rpc -s -H \'content-type:application/json;\' --data-binary \'{"jsonrpc":"2.0","id":"0","method":"submit_transfer", "params":{ "tx_signed_hex": "00-LONG-HASH-00"  }\'\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "id": "0",\n  "jsonrpc": "2.0",\n  "result": {\n    "tx_hash": "864dc39fe1f1440651a9c2cc0585ba2f91498778bae86583d37fcc0b251aea4a"\n  }\n}\n')),(0,l.kt)("p",null,"The transaction is successfully broadcasted over the network."),(0,l.kt)("h3",{id:"important-note-on-watch-only-wallets"},"Important note on watch-only wallets"),(0,l.kt)("p",null,"Watch-only wallet is not able naturally to calculate a balance using only a tracking view secret key and an access to the blockchain. This happens because it can't distinguish spending its own coins as it requires knowing key images for own coins, which are unknown, as key image calculation requires spend secret key."),(0,l.kt)("p",null,"To workaround this difficulty watch-only wallet extracts and stores key images for own coins each time a signed transaction from a cold wallet is broadcasted using ",(0,l.kt)("a",{parentName:"p",href:"https://docs.zano.org/docs/build/rpc-api/wallet-rpc-api/submit_transfer"},"submit_transfer")," RPC. This data is stored locally in .outkey2ki file and it is required to calculate wallet's balance in case of full wallet resync."),(0,l.kt)("p",null,"It's important to keep this data safe and not to delete watch-only wallet's files (including .outkey2ki). Otherwise, watch-only wallet won't be able to calculate its balance correctly and ",(0,l.kt)("strong",{parentName:"p"},"the master wallet may be required to be connected online")," for recovering funds."),(0,l.kt)("p",null,"If it's happen that you lost or damaged outkey2ki, try the following:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Make sure you're running build 2.1.8.414 or more recent.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Stop ",(0,l.kt)("em",{parentName:"p"},"all")," simplewallet processes in ",(0,l.kt)("em",{parentName:"p"},"all")," environments.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Move watch-only wallet file (",(0,l.kt)("inlineCode",{parentName:"p"},"zano_wallet_watch_only"),") to the secure environment, where the master wallet file is located.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"In the secure environment run the following command:"),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"simplewallet --offline-mode --wallet-file=zano_wallet_master --restore-ki-in-wo-wallet=zano_wallet_watch_only"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Enter master wallet's password and watch-only wallet password when prompted.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Make sure it finished successfully.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Move ",(0,l.kt)("inlineCode",{parentName:"p"},"zano_wallet_watch_only")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"zano_wallet_watch_only.outkey2ki")," files to the production environment."))),(0,l.kt)("p",null,"Now watch-only wallet, once fully synced, should show the correct balance."),(0,l.kt)("p",null,"As a last resort you can always move you master wallet to the production environment, run it online (skipping ",(0,l.kt)("inlineCode",{parentName:"p"},"--offline-mode"),"), sync it and transfer all the funds manually to a newly created cold/hot wallet as described above."))}u.isMDXComponent=!0},2633:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/signing-transactions-offline-introduction-a5d2a1a5515dead24e3756c7e1bb6025.png"}}]);